<!-- ===================== START: Cart Vintage Style Enhancements ===================== -->
<style>
/* ===== –í–∏–Ω—Ç–∏–¥–∂ –¥—ä—Ä–≤–µ–Ω–∞ —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ –∑–∞ –±—É—Ç–æ–Ω–∏—Ç–µ ===== */

/* –ë—É—Ç–æ–Ω –ö—É–ø–∏ –∏ –ø–æ–¥–æ–±–Ω–∏ */
.vl-buy-btn, .vl-buy-btn-card, .vl-buy-btn-product {
    background: url('images/old-wood-bg.jpg') no-repeat center/cover !important;
    color: #fff !important;
    border: 1px solid #6B4226;
    font-weight: bold;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    text-shadow: 1px 1px 2px #000;
}
.vl-buy-btn:hover, .vl-buy-btn-card:hover, .vl-buy-btn-product:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

/* Refresh –±—É—Ç–æ–Ω —Å –∏–∫–æ–Ω–∞ */
#vl-refresh-cart {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem 0.75rem;
    background: url('images/old-wood-bg.jpg') no-repeat center/cover;
    color: white;
    border-radius: 0.5rem;
    border: 1px solid #6B4226;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
#vl-refresh-cart::before {
    content: "üîÑ";
    margin-right: 0.5rem;
    font-size: 1.2rem;
}
#vl-refresh-cart:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

/* + / - –±—É—Ç–æ–Ω–∏ –≤ –∫–æ—à–Ω–∏—Ü–∞—Ç–∞ —Å –¥—ä—Ä–≤–µ–Ω —Ñ–æ–Ω */
.vl-qty-minus, .vl-qty-plus {
    background: url('images/old-wood-bg.jpg') no-repeat center/cover;
    color: #fff;
    font-weight: bold;
    border-radius: 4px;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #6B4226;
    text-shadow: 1px 1px 2px #000;
    transition: transform 0.15s ease;
}
.vl-qty-minus:hover, .vl-qty-plus:hover {
    transform: scale(1.1);
}
</style>

<script>
// ===== JS –∑–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç –Ω–∞ + / - –±—É—Ç–æ–Ω–∏—Ç–µ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è =====
(function(){
  function updateHeaderAndTotal(){
    const el = document.querySelector('.cart-count');
    if(!el) return;
    const cartArr = JSON.parse(localStorage.getItem('vl_cart_v1')||'[]');
    el.innerText = cartArr.length;

    const totalEl = document.getElementById('vl-cart-total');
    if(!totalEl) return;
    const counts = {};
    cartArr.forEach(k => counts[k] = (counts[k]||0)+1);
    let total = 0;
    Object.keys(counts).forEach(k => {
        const p = (window.products && products[k]) ? products[k] : {price:0};
        total += (p.price||0)*counts[k];
    });
    totalEl.innerText = `–û–±—â–∞ —Å—É–º–∞: ${total} –ª–≤.`;
  }

  function renderQtyControls(){
    const itemsDiv = document.getElementById('vl-cart-items');
    if(!itemsDiv) return;
    itemsDiv.querySelectorAll('.vl-cart-item').forEach(item=>{
        if(item.querySelector('.vl-qty-controls')) return;
        const key = item.dataset.key;
        const qtySpan = item.querySelector('.vl-qty');
        if(!qtySpan) return;

        const container = document.createElement('div');
        container.className = 'vl-qty-controls flex gap-1 ml-2';
        const minusBtn = document.createElement('button');
        minusBtn.className = 'vl-qty-minus';
        minusBtn.innerText = '‚àí';
        const plusBtn = document.createElement('button');
        plusBtn.className = 'vl-qty-plus';
        plusBtn.innerText = '+';
        container.appendChild(minusBtn);
        container.appendChild(plusBtn);
        qtySpan.parentNode.appendChild(container);

        minusBtn.addEventListener('click', ()=>{
            let cart = JSON.parse(localStorage.getItem('vl_cart_v1')||'[]');
            const idx = cart.indexOf(key);
            if(idx>-1){ cart.splice(idx,1); localStorage.setItem('vl_cart_v1', JSON.stringify(cart)); renderCartPanel(); updateHeaderAndTotal(); }
        });
        plusBtn.addEventListener('click', ()=>{
            let cart = JSON.parse(localStorage.getItem('vl_cart_v1')||'[]');
            cart.push(key); localStorage.setItem('vl_cart_v1', JSON.stringify(cart));
            renderCartPanel(); updateHeaderAndTotal();
        });
    });
  }

  // Patch renderCartPanel –∑–∞ –¥–∞ –º–∞—Ä–∫–∏—Ä–∞ item —Å data-key
  const originalRender = window.renderCartPanel;
  window.renderCartPanel = function(){
    if(originalRender) originalRender();
    const itemsDiv = document.getElementById('vl-cart-items');
    if(!itemsDiv) return;
    itemsDiv.querySelectorAll('div.flex.items-center.justify-between.p-2').forEach(div=>{
        if(!div.classList.contains('vl-cart-item')){
            div.classList.add('vl-cart-item');
            const removeBtn = div.querySelector('.vl-remove');
            if(removeBtn && removeBtn.dataset.key) div.dataset.key = removeBtn.dataset.key;
        }
    });
    renderQtyControls();
  };
})();
</script>
<!-- ===================== END: Cart Vintage Style Enhancements ===================== -->
